<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Next Loc</title>
  <style>
    :root{
      --bg:#121213;
      --panel:#1a1a1b;
      --text:#d7dadc;
      --muted:#818384;
      --border:#3a3a3c;

      --correct:#538d4e;
      --present:#b59f3b;
      --absent:#3a3a3c;

      --gap:8px;
      --radius:10px;
      --tile:62px; /* JS will override for iPhone widths */
      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font);
      background:var(--bg);
      color:var(--text);
      display:flex;
      flex-direction:column;
      min-height:100vh;
      padding:
        env(safe-area-inset-top)
        env(safe-area-inset-right)
        env(safe-area-inset-bottom)
        env(safe-area-inset-left);
    }

    header{
      padding:12px 14px;
      border-bottom:1px solid var(--border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      position:sticky;
      top:0;
      background:var(--bg);
      z-index:5;
    }

    header h1{
      margin:0;
      font-size:16px;
      letter-spacing:0.5px;
      text-transform:uppercase;
      white-space:nowrap;
    }

    .btn{
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      padding:8px 12px;
      border-radius:10px;
      cursor:pointer;
      font-weight:700;
      -webkit-tap-highlight-color: transparent;
    }
    .btn:active{transform:translateY(1px)}

    main{
      width:100%;
      max-width:900px;
      margin:0 auto;
      padding:12px 0 0;
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
    }

    .toast{
      min-height:22px;
      font-weight:800;
      opacity:0;
      transform:translateY(-6px);
      transition:opacity .15s ease, transform .15s ease;
      text-align:center;
      padding:0 12px;
    }
    .toast.show{opacity:1; transform:translateY(0)}

    .board{
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:var(--gap);
      padding:8px 0 6px;
    }

    .row{
      display:grid;
      gap:var(--gap);
      justify-content:center;
      width:100%;
      padding:0 8px;
    }

    .tile{
      width:var(--tile);
      height:var(--tile);
      border:2px solid var(--border);
      border-radius:var(--radius);
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:calc(var(--tile) * 0.52);
      font-weight:900;
      text-transform:uppercase;
      background:var(--panel);
      user-select:none;
    }
    .tile.filled{border-color:#565758}

    .tile.correct{background:var(--correct);border-color:var(--correct)}
    .tile.present{background:var(--present);border-color:var(--present)}
    .tile.absent{background:var(--absent);border-color:var(--absent)}

    /* Keyboard: pinned to bottom, iPhone-friendly */
    .keyboardWrap{
      width:100%;
      position:sticky;
      bottom:0;
      background:var(--bg);
      border-top:1px solid var(--border);
      padding:10px 8px calc(10px + env(safe-area-inset-bottom));
      z-index:6;
    }

    .keyboard{
      width:100%;
      max-width:820px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:8px;
      user-select:none;
    }

    .kb-row{
      display:flex;
      justify-content:center;
      gap:6px;
      flex-wrap:nowrap;
    }

    .key{
      height:48px;
      flex:1 1 0;
      min-width:0;
      padding:0;
      border-radius:12px;
      background:#818384;
      border:none;
      font-weight:900;
      cursor:pointer;
      text-transform:uppercase;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
    }
    .key.wide{flex:1.6 1 0}
    .key.correct{background:var(--correct)}
    .key.present{background:var(--present)}
    .key.absent{background:var(--absent);color:#d7dadc}

    /* Prevent tiny text zoom on iOS inputs (we don't use inputs, but keep font sizes sane) */
    @media (max-width: 430px){
      :root{ --gap:6px; --radius:9px; }
      .key{ height:46px; font-size:14px; }
    }
  </style>
</head>

<body>
<header>
  <h1>hmmm?</h1>
  <button class="btn" id="clearBtn" title="Clear the board">Clear</button>
</header>

<main>
  <div class="toast" id="toast"></div>
  <div class="board" id="board" aria-label="Game board"></div>
</main>

<div class="keyboardWrap">
  <div class="keyboard" id="keyboard" aria-label="On-screen keyboard"></div>
</div>

<script>
(() => {

  // ============================================================
  // EDIT YOUR HIDDEN WORD HERE (any length, letters A–Z only):
  // ============================================================
  const SECRET_WORD = "rudy"; // <-- CHANGE THIS
  // ============================================================

  function normalizeSecret(s){
    return String(s || "")
      .trim()
      .toLowerCase()
      .replace(/[^a-z]/g, "");
  }

  const answer = normalizeSecret(SECRET_WORD);
  const WORD_LEN = answer.length;

  if (WORD_LEN === 0) console.error("SECRET_WORD must contain at least 1 letter A–Z.");

  const board = document.getElementById("board");
  const keyboard = document.getElementById("keyboard");
  const toast = document.getElementById("toast");
  const clearBtn = document.getElementById("clearBtn");

  const KEYS = [
    ["q","w","e","r","t","y","u","i","o","p"],
    ["a","s","d","f","g","h","j","k","l"],
    ["enter","z","x","c","v","b","n","m","back"]
  ];

  const state = {
    rows: [],
    current: [],
    keyStatus: new Map(),
    gameOver: false
  };

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add("show");
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=>toast.classList.remove("show"),1200);
  }

  // Dynamic tile sizing so the grid always fits iPhone width.
  function setTileSize(){
    const w = Math.min(window.innerWidth, 900);
    const sidePadding = 16; // board row padding total approx
    const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--gap")) || 8;
    const available = w - sidePadding - 20; // a little extra breathing room

    // Compute tile size to fit WORD_LEN tiles + (WORD_LEN-1) gaps.
    const raw = (available - (WORD_LEN - 1) * gap) / WORD_LEN;

    // Clamp for usability.
    const tile = Math.max(34, Math.min(62, Math.floor(raw)));
    document.documentElement.style.setProperty("--tile", tile + "px");
  }

  // Wordle scoring generalized to any length, with duplicate handling.
  function scoreGuess(guess, answer){
    const n = answer.length;
    const res = Array(n).fill("absent");
    const a = answer.split("");
    const g = guess.split("");

    for (let i = 0; i < n; i++){
      if (g[i] === a[i]){
        res[i] = "correct";
        a[i] = null;
        g[i] = null;
      }
    }
    for (let i = 0; i < n; i++){
      if (g[i] == null) continue;
      const idx = a.indexOf(g[i]);
      if (idx !== -1){
        res[i] = "present";
        a[idx] = null;
      }
    }
    return res;
  }

  function mergeKeyStatus(letter, status){
    const prev = state.keyStatus.get(letter);
    const rank = s => (s === "correct" ? 3 : s === "present" ? 2 : s === "absent" ? 1 : 0);
    if (!prev || rank(status) > rank(prev)) state.keyStatus.set(letter, status);
  }

  function submit(){
    if (state.gameOver) return;

    if (state.current.length < WORD_LEN){
      showToast(`Need ${WORD_LEN} letters.`);
      return;
    }

    const guess = state.current.join("").toLowerCase();
    if (!new RegExp(`^[a-z]{${WORD_LEN}}$`).test(guess)){
      showToast("Only letters A–Z.");
      return;
    }

    const result = scoreGuess(guess, answer);

    state.rows.push({ letters: [...state.current], result });
    for (let i = 0; i < WORD_LEN; i++) mergeKeyStatus(state.current[i], result[i]);

    state.current = [];

    if (result.every(r => r === "correct")){
      state.gameOver = true;
      showToast(`Correct: ${answer.toUpperCase()}`);
    }

    render();
  }

  function addLetter(ch){
    if (state.gameOver) return;
    if (state.current.length >= WORD_LEN) return;
    if (!/^[a-z]$/i.test(ch)) return;
    state.current.push(ch.toLowerCase());
    render();
  }

  function backspace(){
    if (state.gameOver) return;
    if (state.current.length === 0) return;
    state.current.pop();
    render();
  }

  function makeRow(letters, result){
    const row = document.createElement("div");
    row.className = "row";
    row.style.gridTemplateColumns = `repeat(${WORD_LEN}, var(--tile))`;

    for (let i = 0; i < WORD_LEN; i++){
      const t = document.createElement("div");
      const l = letters[i] || "";
      t.className = "tile" + (l ? " filled" : "") + (result ? (" " + result[i]) : "");
      t.textContent = l;
      row.appendChild(t);
    }
    return row;
  }

  function render(){
    board.innerHTML = "";

    for (const r of state.rows){
      board.appendChild(makeRow(r.letters, r.result));
    }

    if (!state.gameOver){
      board.appendChild(makeRow(state.current, null));
    }

    keyboard.innerHTML = "";
    for (const rowKeys of KEYS){
      const r = document.createElement("div");
      r.className = "kb-row";

      for (const k of rowKeys){
        const b = document.createElement("button");
        b.type = "button";
        b.className = "key" + ((k === "enter" || k === "back") ? " wide" : "");
        b.textContent = (k === "back") ? "⌫" : (k === "enter" ? "Enter" : k);

        if (k.length === 1){
          const st = state.keyStatus.get(k);
          if (st) b.classList.add(st);
          b.addEventListener("click", () => addLetter(k));
        } else if (k === "enter"){
          b.addEventListener("click", submit);
        } else {
          b.addEventListener("click", backspace);
        }

        r.appendChild(b);
      }
      keyboard.appendChild(r);
    }
  }

  clearBtn.addEventListener("click", () => {
    state.rows = [];
    state.current = [];
    state.keyStatus.clear();
    state.gameOver = false;
    render();
    showToast("Cleared.");
  });

  document.addEventListener("keydown", (e) => {
    if (e.ctrlKey || e.metaKey || e.altKey) return;

    if (e.key === "Enter") return submit();
    if (e.key === "Backspace") return backspace();
    if (/^[a-z]$/i.test(e.key)) return addLetter(e.key.toLowerCase());
  });

  // Initial sizing + resize handling (critical for iPhone orientation changes)
  setTileSize();
  window.addEventListener("resize", () => { setTileSize(); render(); });
  window.addEventListener("orientationchange", () => { setTileSize(); render(); });

  render();
})();
</script>
</body>
</html>
